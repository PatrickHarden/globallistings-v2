{"ast":null,"code":"import _objectSpread from \"/Users/zentoo/Code/v2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\n// @ts-nocheck\nimport { createSelector } from 'reselect';\nimport { stringify } from 'querystring';\nimport { configSelector, filtersSelector } from './state';\nimport { intlSelector } from './intl';\nimport { searchPathSelector as uiSearchPathSelector, suggestionsSelector, selectedSuggestionSelector, selectedFiltersSelector } from './ui';\nimport { hideBuyButtonSelector, hideLetButtonSelector, searchResultsPageSelector, searchPathSelectorSelector as configSearchPathSelectorSelector } from './config/config';\nimport { defaultFiltersParamsSelectors } from './config/filters';\nimport { TransactionTypeValue } from '../../types/config';\nimport { plpUrlPathParamsSelector } from './match';\nimport { filterParamsCombiner } from './config/range-filters';\nexport var buyButtonTextSelector = createSelector(hideBuyButtonSelector, intlSelector, function (hideBuyButton, intl) {\n  return hideBuyButton ? intl.formatMessage({\n    id: 'GenericSearchButton'\n  }) : intl.formatMessage({\n    id: 'SearchToBuyButton'\n  });\n});\nexport var letButtonTextSelector = createSelector(hideBuyButtonSelector, intlSelector, function (hideBuyButton, intl) {\n  return hideBuyButton ? intl.formatMessage({\n    id: 'GenericSearchButton'\n  }) : intl.formatMessage({\n    id: 'SearchToLetButton'\n  });\n});\nexport var displaySearchPathSelectorSelector = createSelector(configSelector, function (config) {\n  return config.searchConfig.searchPathSelector && config.searchConfig.searchPathSelector.length > 0;\n});\nvar defaultSearchPathValueSelector = createSelector(configSearchPathSelectorSelector, function (searchPaths) {\n  if (!searchPaths || !searchPaths.length) {\n    return undefined;\n  }\n\n  var defaultSearchPath = searchPaths.find(function (sp) {\n    return sp.default;\n  });\n\n  if (!defaultSearchPath) {\n    throw new Error('If searchPaths are present there must always be a default one');\n  }\n\n  return defaultSearchPath.value;\n});\nexport var searchPathSelector = createSelector(uiSearchPathSelector, defaultSearchPathValueSelector, function (uiSearchPath, defaultSearchPath) {\n  return uiSearchPath || defaultSearchPath;\n});\nexport var plpPathSelector = createSelector(searchPathSelector, searchResultsPageSelector, function (searchPath, searchResultsPage) {\n  if (!searchPath && !searchResultsPage) {\n    throw new Error('SearchPath of search');\n  }\n\n  return searchPath || searchResultsPage;\n});\nvar filtersParamsSelector = createSelector(selectedFiltersSelector, defaultFiltersParamsSelectors, function (selectedFilters, defaultFilters) {\n  return _objectSpread({}, defaultFilters, selectedFilters);\n});\nexport var v1FilterParamsSelector = createSelector(filtersParamsSelector, filtersSelector, function () {\n  return true;\n}, function () {\n  return false;\n}, filterParamsCombiner);\nvar uiSearchParamsSelector = createSelector(selectedSuggestionSelector, function (suggestion) {\n  return !!suggestion ? {\n    placeId: suggestion.placeId,\n    location: suggestion.description\n  } : {};\n});\nvar searchParamsSelector = createSelector(v1FilterParamsSelector, uiSearchParamsSelector, function (filterParams, uiParams) {\n  return _objectSpread({}, filterParams, uiParams);\n});\nexport var searchLinkSelector = function searchLinkSelector(linkType) {\n  return createSelector(plpPathSelector, searchParamsSelector, selectedSuggestionSelector, function (plpPath, params, suggestion) {\n    var newParams = _objectSpread({}, params, {\n      aspects: linkType\n    }); // TODO: this needs to be moved into state and a selector created to retrieve it\n    // also a non null assertion operator added and tested\n    // TODO: do we really want to add /details here?\n\n\n    if (suggestion !== undefined && suggestion.propertyResult !== undefined) {\n      if (suggestion.propertyResult.propertyPartialPath !== undefined) {\n        return \"\".concat(suggestion.propertyResult.searchPath, \"/details/\").concat(suggestion.propertyResult.propertyPartialPath, \"?view=\").concat(linkType);\n      }\n    }\n\n    return \"\".concat(plpPath, \"?\").concat(stringify(newParams));\n  });\n};\nexport var buyButtonInfoSelector = createSelector(buyButtonTextSelector, searchLinkSelector(TransactionTypeValue.isSale), hideBuyButtonSelector, selectedSuggestionSelector, function (text, url, hide, suggestion) {\n  var toShow = suggestion !== undefined && suggestion.propertyResult !== undefined && suggestion.propertyResult.propertyAspects !== undefined ? suggestion.propertyResult.propertyAspects.includes('isSale') : !hide;\n  return {\n    text: text,\n    url: url,\n    visible: toShow\n  };\n});\nexport var letButtonInfoSelector = createSelector(letButtonTextSelector, searchLinkSelector(TransactionTypeValue.isLetting), hideLetButtonSelector, selectedSuggestionSelector, function (text, url, hide, suggestion) {\n  var toShow = suggestion !== undefined && suggestion.propertyResult !== undefined && suggestion.propertyResult.propertyAspects !== undefined ? suggestion.propertyResult.propertyAspects.includes('isLetting') : !hide;\n  return {\n    text: text,\n    url: url,\n    visible: toShow\n  };\n});\nexport var locationLookupSuggestionsSelector = createSelector(suggestionsSelector, function (suggestions) {\n  return suggestions.map(function (suggestion) {\n    return {\n      label: suggestion.description,\n      value: suggestion.placeId,\n      default: false\n    };\n  });\n});\nexport var initialSearchLocationSelector = createSelector(plpUrlPathParamsSelector, function (_ref) {\n  var location = _ref.location;\n  return location;\n});","map":{"version":3,"names":["createSelector","stringify","configSelector","filtersSelector","intlSelector","searchPathSelector","uiSearchPathSelector","suggestionsSelector","selectedSuggestionSelector","selectedFiltersSelector","hideBuyButtonSelector","hideLetButtonSelector","searchResultsPageSelector","searchPathSelectorSelector","configSearchPathSelectorSelector","defaultFiltersParamsSelectors","TransactionTypeValue","plpUrlPathParamsSelector","filterParamsCombiner","buyButtonTextSelector","hideBuyButton","intl","formatMessage","id","letButtonTextSelector","displaySearchPathSelectorSelector","config","searchConfig","length","defaultSearchPathValueSelector","searchPaths","undefined","defaultSearchPath","find","sp","default","Error","value","uiSearchPath","plpPathSelector","searchPath","searchResultsPage","filtersParamsSelector","selectedFilters","defaultFilters","v1FilterParamsSelector","uiSearchParamsSelector","suggestion","placeId","location","description","searchParamsSelector","filterParams","uiParams","searchLinkSelector","linkType","plpPath","params","newParams","aspects","propertyResult","propertyPartialPath","buyButtonInfoSelector","isSale","text","url","hide","toShow","propertyAspects","includes","visible","letButtonInfoSelector","isLetting","locationLookupSuggestionsSelector","suggestions","map","label","initialSearchLocationSelector"],"sources":["/Users/zentoo/Code/v2/src/redux/selectors/search.ts"],"sourcesContent":["// @ts-nocheck\nimport { createSelector } from 'reselect';\nimport { stringify } from 'querystring';\n\nimport { configSelector, filtersSelector } from './state';\nimport { intlSelector } from './intl';\nimport {\n  searchPathSelector as uiSearchPathSelector,\n  suggestionsSelector,\n  selectedSuggestionSelector,\n  selectedFiltersSelector,\n} from './ui';\nimport {\n  hideBuyButtonSelector,\n  hideLetButtonSelector,\n  searchResultsPageSelector,\n  searchPathSelectorSelector as configSearchPathSelectorSelector,\n} from './config/config';\nimport { defaultFiltersParamsSelectors } from './config/filters';\nimport { TransactionTypeValue } from '../../types/config';\nimport { plpUrlPathParamsSelector } from './match';\nimport { filterParamsCombiner } from './config/range-filters';\n\nexport interface ButtonInfo {\n  readonly text: string;\n  readonly url: string;\n  readonly visible: boolean;\n}\n\nexport const buyButtonTextSelector = createSelector(\n  hideBuyButtonSelector,\n  intlSelector,\n  (hideBuyButton, intl) =>\n    hideBuyButton\n      ? intl.formatMessage({ id: 'GenericSearchButton' })\n      : intl.formatMessage({ id: 'SearchToBuyButton' })\n);\n\nexport const letButtonTextSelector = createSelector(\n  hideBuyButtonSelector,\n  intlSelector,\n  (hideBuyButton, intl) =>\n    hideBuyButton\n      ? intl.formatMessage({ id: 'GenericSearchButton' })\n      : intl.formatMessage({ id: 'SearchToLetButton' })\n);\n\nexport const displaySearchPathSelectorSelector = createSelector(\n  configSelector,\n  config =>\n    config.searchConfig.searchPathSelector && config.searchConfig.searchPathSelector.length > 0\n);\n\nconst defaultSearchPathValueSelector = createSelector(\n  configSearchPathSelectorSelector,\n  searchPaths => {\n    if (!searchPaths || !searchPaths.length) {\n      return undefined;\n    }\n\n    const defaultSearchPath = searchPaths.find(sp => sp.default);\n\n    if (!defaultSearchPath) {\n      throw new Error('If searchPaths are present there must always be a default one');\n    }\n\n    return defaultSearchPath.value;\n  }\n);\n\nexport const searchPathSelector = createSelector(\n  uiSearchPathSelector,\n  defaultSearchPathValueSelector,\n  (uiSearchPath, defaultSearchPath) => uiSearchPath || defaultSearchPath\n);\n\nexport const plpPathSelector = createSelector(\n  searchPathSelector,\n  searchResultsPageSelector,\n  (searchPath, searchResultsPage) => {\n    if (!searchPath && !searchResultsPage) {\n      throw new Error('SearchPath of search');\n    }\n\n    return searchPath || searchResultsPage;\n  }\n);\n\nconst filtersParamsSelector = createSelector(\n  selectedFiltersSelector,\n  defaultFiltersParamsSelectors,\n  (selectedFilters, defaultFilters) => ({ ...defaultFilters, ...selectedFilters })\n);\n\nexport const v1FilterParamsSelector = createSelector(\n  filtersParamsSelector,\n  filtersSelector,\n  () => true,\n  () => false,\n  filterParamsCombiner\n);\n\nconst uiSearchParamsSelector = createSelector(selectedSuggestionSelector, suggestion =>\n  !!suggestion ? { placeId: suggestion.placeId, location: suggestion.description } : {}\n);\n\nconst searchParamsSelector = createSelector(\n  v1FilterParamsSelector,\n  uiSearchParamsSelector,\n  (filterParams, uiParams) => ({ ...filterParams, ...uiParams })\n);\n\nexport const searchLinkSelector = (linkType: TransactionTypeValue) =>\n  createSelector(\n    plpPathSelector,\n    searchParamsSelector,\n    selectedSuggestionSelector,\n    (plpPath, params, suggestion) => {\n      const newParams = {\n        ...params,\n        aspects: linkType,\n      };\n\n      // TODO: this needs to be moved into state and a selector created to retrieve it\n      // also a non null assertion operator added and tested\n      // TODO: do we really want to add /details here?\n      if (suggestion !== undefined && suggestion!.propertyResult !== undefined) {\n        if (suggestion.propertyResult!.propertyPartialPath !== undefined) {\n          return `${suggestion.propertyResult!.searchPath}/details/${\n            suggestion.propertyResult!.propertyPartialPath\n          }?view=${linkType}`;\n        }\n      }\n\n      return `${plpPath}?${stringify(newParams)}`;\n    }\n  );\n\nexport const buyButtonInfoSelector = createSelector(\n  buyButtonTextSelector,\n  searchLinkSelector(TransactionTypeValue.isSale),\n  hideBuyButtonSelector,\n  selectedSuggestionSelector,\n  (text, url, hide, suggestion): ButtonInfo => {\n    const toShow =\n      suggestion !== undefined &&\n      suggestion!.propertyResult !== undefined &&\n      suggestion!.propertyResult!.propertyAspects !== undefined\n        ? suggestion!.propertyResult!.propertyAspects!.includes('isSale')\n        : !hide;\n    return {\n      text,\n      url,\n      visible: toShow,\n    };\n  }\n);\n\nexport const letButtonInfoSelector = createSelector(\n  letButtonTextSelector,\n  searchLinkSelector(TransactionTypeValue.isLetting),\n  hideLetButtonSelector,\n  selectedSuggestionSelector,\n  (text, url, hide, suggestion): ButtonInfo => {\n    const toShow =\n      suggestion !== undefined &&\n      suggestion!.propertyResult !== undefined &&\n      suggestion!.propertyResult!.propertyAspects !== undefined\n        ? suggestion!.propertyResult!.propertyAspects!.includes('isLetting')\n        : !hide;\n    return {\n      text,\n      url,\n      visible: toShow,\n    };\n  }\n);\n\nexport interface AutocompleteSuggestion {\n  readonly label: string;\n  readonly value: string;\n  readonly default: boolean;\n}\n\nexport const locationLookupSuggestionsSelector = createSelector(\n  suggestionsSelector,\n  (suggestions): AutocompleteSuggestion[] =>\n    suggestions.map(suggestion => ({\n      label: suggestion.description,\n      value: suggestion.placeId,\n      default: false,\n    }))\n);\n\nexport const initialSearchLocationSelector = createSelector(\n  plpUrlPathParamsSelector,\n  ({ location }) => location\n);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}